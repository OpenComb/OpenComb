module.exports.buildView = function(ele,shipper,callback)
{
	shipper = shipper || jQuery.shipper ;

	ele._children = {} ;
	ele._tpl = null ;

	$ele = jQuery(ele) ;

	ele.name = ele.controller = $ele.attr("controller") ;
	ele.params = $ele.attr("params") ;
	ele.sumsign = $ele.attr("sumsign") || null ;
	ele.onshowSrc = $ele.attr("onviewshow") ;

	ele.reload = function(data,method)
	{
		$.request(
			{
				url: jQuery(this).attr('controller')
				, data: data
				, type: method
			}
			, this
		) ;
	}

	if(ele.sumsign)
	{
		$oc.views[ ele.sumsign ] = ele ;
	}

	// 加载onshow
	if( ele.onshowSrc )
	{
		shipper.require(ele.onshowSrc,function(err){
			if(err)
			{
				callback && callback (err,ele) ;
				return ;
			}

			var module = shipper.module(ele.onshowSrc) ;

			var type = typeof module ;
			if( type=="function" )
			{
				ele.onviewshow = function(){

					var $view = jQuery(ele) ;
					var $ = function(){
						return $view.find.apply($view,arguments) ;
					}
					$.__proto__ = jQuery ;

					module.call(ele,$) ;
				} ;
			}
			else
			{
				err = "onviewshow script of view must exports a function, but input is a "+type+", src: "+ele.onshowSrc ;
			}

			callback && callback (err,ele) ;
		}) ;
	}
	else
	{
		callback && callback (null,ele) ;
	}

	return ele ;
}

