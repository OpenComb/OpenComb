var Class = require("ocClass/lib/Class.js") ;

var Template = require("ocTemplate/lib/Template.js") ;
var TemplateCaches = require("ocTemplate/lib/TemplateCaches.js") ;


module.exports = function(templateClass,parser,generator){
	TemplateCaches.call( this, templateClass, parser||module.exports.parser, generator||module.exports.generator ) ;
}
module.exports.prototype.__proto__ = TemplateCaches.prototype ;
module.exports.prototype.template = function(filename,callback,from)
{
	return TemplateCaches.prototype.template.call(this,filename,function(err,tpl){
		tpl.filename = filename ;
		callback && callback(err,tpl) ;
	},from) ;
}


// Parser ------------
var Parser = require("ocTemplate/lib/Parser.js") ;
var htmlParserConfig = Class.cloneObject(null,Parser.htmlParserFactoryConfig) ;
htmlParserConfig.stateMachines.StateTag.properties.emptyTags.view = 1 ;
htmlParserConfig.stateMachines.StateTag.properties.emptyTags.assets = 1 ;

module.exports.parser = new Parser(htmlParserConfig) ;


// Generator ------------
var Generator = require("ocTemplate/lib/Generator.js") ;
module.exports.generator = new Generator ;
module.exports.generator.registerShaderDefine(require("./shaders/view.js")) ;
module.exports.generator.registerShaderDefine(require("./shaders/assets.js")) ;



// singleton -----------
module.exports.singleton = new module.exports() ;


module.exports.__SHIPPABLE = true ;