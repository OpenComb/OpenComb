
// 释放 $ 变量
// jQuery.noConflict() ;

// 兼容 jquery 1.9 以前的版本
jQuery.browser = {
	mozilla:	/firefox/.test(navigator.userAgent.toLowerCase())
	, webkit:	/webkit/.test(navigator.userAgent.toLowerCase())
	, opera:	/opera/.test(navigator.userAgent.toLowerCase())
	, msie:		/msie/.test(navigator.userAgent.toLowerCase())
} ;

var $oc = null ;

jQuery(function($){

	var shipdownloads = [
		"ocPlatform/lib/frontend/patchs.js"
		, "ocTemplate/lib/TemplateCaches.js"
		, "ocPlatform/lib/frontend/mvc/View.js"
		, "ocPlatform/lib/frontend/mvc/Director.js"
	] ;

	var initOpenComb = function() {

		console.log("initOpenComb()") ;

		// 为浏览器打补丁，以便一些为 node.js 开发的 module 可以在浏览器中运行
		$oc.shipper.module("ocPlatform/lib/frontend/patchs.js") ;


		// 初始化视图
		var View = $oc.shipper.module("ocPlatform/lib/frontend/mvc/View.js") ;
		$(".ocview").each(function(){
			View.buildView( this, $oc.shipper ) ;
		}) ;


		// init controller director
		var Director = $oc.shipper.module("ocPlatform/lib/frontend/mvc/Director.js") ;
		$oc.director = new Director( $(document) ) ;
		$oc.director.setup("a","click") ;


		console.log("OpenComb frontend has loaded on your browser :)") ;
	}



	$oc = $(document) ;
	$oc.views = {} ;
	$oc.viewpool = [] ;
	$oc.shipper = new Shipper() ;
	$shipper = $oc.shipper ;		// init global variable $shipper

	var waiting = shipdownloads.length ;
	for(var i=0;i<shipdownloads.length;i++)
	{
		$oc.shipper.require(shipdownloads[i],function(err,path,module){

			if(err)
			{
				throw err ;
			}
			if( !(--waiting) )
			{
				initOpenComb() ;
			}
		}) ;
	}





}) ;

